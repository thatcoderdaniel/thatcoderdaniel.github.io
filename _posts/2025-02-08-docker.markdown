---
layout: post
title: "Cloud"
date: 2025-02-08 17:17:31 -0500
categories: technical
---

# KodeKloud

Using KodeKloud's playground to grasp Docker.
[KK Playground](https://learn.kodekloud.com/user/playgrounds/playground-docker)

# Docker Getting Started

[Getting Started](https://docs.docker.com/compose/gettingstarted/)

Used Docker's docu in conjunction, to help me build things up.

Ingredients:

```java
nano requirements.txt
```

<a href="/assets/img/requirements.jpg" target="_blank">
  <img src="/assets/img/requirements.jpg" alt="Requirements">
</a>

```yaml
nano Dockerfile.txt
```

```
# syntax=docker/dockerfile:1
FROM python:3.10-alpine
WORKDIR /code
ENV FLASK_APP=app.py
ENV FLASK_RUN_HOST=0.0.0.0
RUN apk add --no-cache gcc musl-dev linux-headers
COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt
EXPOSE 5000
COPY . .
CMD ["flask", "run", "--debug"]
```

# compose.yaml

```yaml
services:
  web:
    build: .
    ports:
      - "8000:5000"
  redis:
    image: "redis:alpine"
```

# Composer Up!

```cli
docker compose up
```

```java
admin@docker-host ➜  docker compose up
Compose now can delegate build to bake for better performances
Just set COMPOSE_BAKE=true
[+] Building 74.0s (15/15) FINISHED                                            docker:default
 => [web internal] load build definition from Dockerfile                                 0.1s
 => => transferring dockerfile: 332B                                                     0.1s
 => [web] resolve image config for docker-image://docker.io/docker/dockerfile:1         30.1s
 => CACHED [web] docker-image://docker.io/docker/dockerfile:1@sha256:38387523653efa0039  0.0s
 => [web internal] load build definition from Dockerfile                                 0.0s
 => [web internal] load metadata for docker.io/library/python:3.10-alpine               30.1s
 => [web internal] load .dockerignore                                                    0.0s
 => => transferring context: 2B                                                          0.0s
 => [web 1/6] FROM docker.io/library/python:3.10-alpine@sha256:f00e977f6932588d3814f932  0.0s
 => [web internal] load build context                                                    0.0s
 => => transferring context: 424B                                                        0.0s
 => CACHED [web 2/6] WORKDIR /code                                                       0.0s
 => [web 3/6] RUN apk add --no-cache gcc musl-dev linux-headers                          3.8s
 => [web 4/6] COPY requirements.txt requirements.txt                                     0.1s
 => [web 5/6] RUN pip install -r requirements.txt                                        6.9s
 => [web 6/6] COPY . .                                                                   0.1s
 => [web] exporting to image                                                             2.4s
 => => exporting layers                                                                  2.4s
 => => writing image sha256:b6755574873ec7c71e0ac6f6f2b0f761274cc0587916f1365735e45b9e6  0.0s
 => => naming to docker.io/library/composetest-web                                       0.0s
 => [web] resolving provenance for metadata file                                         0.0s
[+] Running 4/4
 ✔ web                            Built                                                  0.0s
 ✔ Network composetest_default    Created                                                0.2s
 ✔ Container composetest-web-1    Created                                                0.0s
 ✔ Container composetest-redis-1  Created                                                0.0s
Attaching to redis-1, web-1
redis-1  | Starting Redis Server
redis-1  | 1:C 12 Aug 2025 21:12:37.919 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
redis-1  | 1:C 12 Aug 2025 21:12:37.919 * Redis version=8.2.0, bits=64, commit=00000000, modified=1, pid=1, just started
redis-1  | 1:C 12 Aug 2025 21:12:37.919 * Configuration loaded
redis-1  | 1:M 12 Aug 2025 21:12:37.919 * monotonic clock: POSIX clock_gettime
redis-1  | 1:M 12 Aug 2025 21:12:37.920 * Running mode=standalone, port=6379.
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf> RedisBloom version 8.2.0 (Git=unknown)
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf> Registering configuration options: [
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf>  { bf-error-rate       :      0.01 }
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf>  { bf-initial-size     :       100 }
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf>  { bf-expansion-factor :         2 }
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf>  { cf-bucket-size      :         2 }
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf>  { cf-initial-size     :      1024 }
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf>  { cf-max-iterations   :        20 }
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf>  { cf-expansion-factor :         1 }
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf>  { cf-max-expansions   :        32 }
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * <bf> ]
redis-1  | 1:M 12 Aug 2025 21:12:37.922 * Module 'bf' loaded from /usr/local/lib/redis/modules//redisbloom.so
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> Redis version found by RedisSearch : 8.2.0 - oss
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> RediSearch version 8.2.0 (Git=d81ebce)
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> Low level api version 1 initialized successfully
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> gc: ON, prefix min length: 2, min word length to stem: 4, prefix max expansions: 200, query timeout (ms): 500, timeout policy: return, cursor read size: 1000, cursor max idle (ms): 300000, max doctable size: 1000000, max number of search results:  1000000,
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> Initialized thread pools!
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> Disabled workers threadpool of size 0
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> Subscribe to config changes
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> Enabled role change notification
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> Cluster configuration: AUTO partitions, type: 0, coordinator timeout: 0ms
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * <search> Register write commands
redis-1  | 1:M 12 Aug 2025 21:12:37.926 * Module 'search' loaded from /usr/local/lib/redis/modules//redisearch.so
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries> RedisTimeSeries version 80200, git_sha=1439d4a439ca9c063e6ef124a510abff09a5d493
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries> Redis version found by RedisTimeSeries : 8.2.0 - oss
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries> Registering configuration options: [
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries>  { ts-compaction-policy   :              }
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries>  { ts-num-threads         :            3 }
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries>  { ts-retention-policy    :            0 }
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries>  { ts-duplicate-policy    :        block }
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries>  { ts-chunk-size-bytes    :         4096 }
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries>  { ts-encoding            :   compressed }
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries>  { ts-ignore-max-time-diff:            0 }
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries>  { ts-ignore-max-val-diff :     0.000000 }
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries> ]
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries> Detected redis oss
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <timeseries> Enabled diskless replication
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * Module 'timeseries' loaded from /usr/local/lib/redis/modules//redistimeseries.so
redis-1  | 1:M 12 Aug 2025 21:12:37.927 * <ReJSON> Created new data type 'ReJSON-RL'
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * <ReJSON> version: 80200 git sha: unknown branch: unknown
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * <ReJSON> Exported RedisJSON_V1 API
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * <ReJSON> Exported RedisJSON_V2 API
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * <ReJSON> Exported RedisJSON_V3 API
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * <ReJSON> Exported RedisJSON_V4 API
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * <ReJSON> Exported RedisJSON_V5 API
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * <ReJSON> Enabled diskless replication
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * <ReJSON> Initialized shared string cache, thread safe: false.
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * Module 'ReJSON' loaded from /usr/local/lib/redis/modules//rejson.so
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * <search> Acquired RedisJSON_V5 API
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * Server initialized
redis-1  | 1:M 12 Aug 2025 21:12:37.928 * Ready to accept connections tcp
web-1    |  * Serving Flask app 'app.py'
web-1    |  * Debug mode: on
web-1    | WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
web-1    |  * Running on all addresses (0.0.0.0)
web-1    |  * Running on http://127.0.0.1:5000
web-1    |  * Running on http://172.17.0.3:5000
web-1    | Press CTRL+C to quit
web-1    |  * Restarting with stat
web-1    |  * Debugger is active!
web-1    |  * Debugger PIN: 590-324-880
```

Oh, yeah a simple app.py was given by Docker to test this all out.

# app.py

```python
import time

import redis
from flask import Flask

app = Flask(__name__)
cache = redis.Redis(host='redis', port=6379)

def get_hit_count():
    retries = 5
    while True:
        try:
            return cache.incr('hits')
        except redis.exceptions.ConnectionError as exc:
            if retries == 0:
                raise exc
            retries -= 1
            time.sleep(0.5)

@app.route('/')
def hello():
    count = get_hit_count()
    return f'Hello World! I have been seen {count} times.\n'
```

Beware, localhost has entered the chat.
<a href="/assets/img/localhost8000.png" target="_blank">
<img src="/assets/img/localhost8000.png" alt="Requirements">
</a>

```cli
docker image ls
```

<a href="/assets/img/dockerimagels.png" target="_blank">
<img src="/assets/img/dockerimagels.png" alt="Requirements">
</a>

docker inspect <id>

```yaml
docker inspect b6755574873e
[
    {
        "Id": "sha256:b6755574873ec7c71e0ac6f6f2b0f761274cc0587916f1365735e45b9e6ddc93",
        "RepoTags": [
            "composetest-web:latest"
        ],
        "RepoDigests": [],
        "Parent": "",
        "Comment": "buildkit.dockerfile.v0",
        "Created": "2025-08-12T17:12:34.23518973-04:00",
        "DockerVersion": "",
        "Author": "",
        "Config": {
            "Hostname": "",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "ExposedPorts": {
                "5000/tcp": {}
            },
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": [
                "PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
                "LANG=C.UTF-8",
                "GPG_KEY=A035C8C19219BA821ECEA86B64E628F8D684696D",
                "PYTHON_VERSION=3.10.18",
                "PYTHON_SHA256=ae665bc678abd9ab6a6e1573d2481625a53719bc517e9a634ed2b9fefae3817f",
                "FLASK_APP=app.py",
                "FLASK_RUN_HOST=0.0.0.0"
            ],
            "Cmd": [
                "flask",
                "run",
                "--debug"
            ],
            "ArgsEscaped": true,
            "Image": "",
            "Volumes": null,
            "WorkingDir": "/code",
            "Entrypoint": null,
            "OnBuild": null,
            "Labels": {
                "com.docker.compose.project": "composetest",
                "com.docker.compose.service": "web",
                "com.docker.compose.version": "2.33.1"
            }
        },
        "Architecture": "amd64",
        "Os": "linux",
        "Size": 244409952,
        "GraphDriver": {
            "Data": {
                "LowerDir": "/var/lib/docker/overlay2/1b1c13lsq1m57eod2j8aghpqf/diff:/var/lib/docker/overlay2/ryafkkzftsbc4fpa87z7iupfl/diff:/var/lib/docker/overlay2/1d2c8jft6o8kp0pb09dlncot0/diff:/var/lib/docker/overlay2/0088u5l46feb2h18sa0vfdn3u/diff:/var/lib/docker/overlay2/67a0143af2ff3e533beb1b05be3440b1cf25b1ee490058330517001d66ab3985/diff:/var/lib/docker/overlay2/6797dbe66ab972fb125b4ae14c20c8becaf1facd99d9a7480c49daf8bc522de5/diff:/var/lib/docker/overlay2/4171e359dbbb95ce8a6d08614043772d22be1bf6e9cee5069b40b395e3d42581/diff:/var/lib/docker/overlay2/a9067191e0efed5199241c39d02b0ee04a4eb83420097140e99cd7f66a202a0c/diff",
                "MergedDir": "/var/lib/docker/overlay2/ffjc2onvsrkwkwt86hcp103or/merged",
                "UpperDir": "/var/lib/docker/overlay2/ffjc2onvsrkwkwt86hcp103or/diff",
                "WorkDir": "/var/lib/docker/overlay2/ffjc2onvsrkwkwt86hcp103or/work"
            },
            "Name": "overlay2"
        },
        "RootFS": {
            "Type": "layers",
            "Layers": [
                "sha256:418dccb7d85a63a6aa574439840f7a6fa6fd2321b3e2394568a317735e867d35",
                "sha256:7fbb78f789f6d9e6e3b8ec1eeca9f85297305c85839c7d71849e2c99d16eb51c",
                "sha256:8a50bd160075d50061a5db18c8d78f2dc681c8df00e344b20d740695bcf23377",
                "sha256:a29817a283cf418020fc7417bc6fca37824fdd6dc4a4561cf47ad3a1c2de71e6",
                "sha256:6ac39fd483130b26817f08bd26e14d452a26632ddcf24a95903a3a30c975be06",
                "sha256:671a8157fa6c5c105074fe970d6ea9a2eeb96879ee1f0992243859ef9a7ac1c0",
                "sha256:df5b7c6dab581633739cc292cf7c041aa7961b8a42084bf348d44e1c72302e64",
                "sha256:14350e71d52eb6fcf236617b0f3702da7062ea0aa8b605474445a69e36792712",
                "sha256:f390b9a4c80c3bf5cda7b8b45ad042e125ec720dcbaac4a3388a1e9095a94eaf"
            ]
        },
        "Metadata": {
            "LastTagTime": "2025-08-12T17:12:36.673334766-04:00"
        }
    }
]
```

Now, I've added this watch line in my composer.yaml

````yaml
services:
  web:
    build: .
    ports:
      - "8000:5000"
    develop:
      watch:
        - action: sync
          path: .
          target: /code
  redis:
    image: "redis:alpine"
    ```


````

```
docker composer watch
```

```yaml
docker compose watch
Compose now can delegate build to bake for better performances
Just set COMPOSE_BAKE=true
[+] Building 60.8s (15/15) FINISHED                                            docker:default
 => [web internal] load build definition from Dockerfile                                 0.1s
 => => transferring dockerfile: 332B                                                     0.0s
 => [web] resolve image config for docker-image://docker.io/docker/dockerfile:1         30.1s
 => CACHED [web] docker-image://docker.io/docker/dockerfile:1@sha256:38387523653efa0039  0.0s
 => [web internal] load build definition from Dockerfile                                 0.0s
 => [web internal] load metadata for docker.io/library/python:3.10-alpine               30.2s
 => [web internal] load .dockerignore                                                    0.0s
 => => transferring context: 2B                                                          0.0s
 => [web 1/6] FROM docker.io/library/python:3.10-alpine@sha256:f00e977f6932588d3814f932  0.0s
 => [web internal] load build context                                                    0.0s
 => => transferring context: 323B                                                        0.0s
 => CACHED [web 2/6] WORKDIR /code                                                       0.0s
 => CACHED [web 3/6] RUN apk add --no-cache gcc musl-dev linux-headers                   0.0s
 => CACHED [web 4/6] COPY requirements.txt requirements.txt                              0.0s
 => CACHED [web 5/6] RUN pip install -r requirements.txt                                 0.0s
 => [web 6/6] COPY . .                                                                   0.1s
 => [web] exporting to image                                                             0.0s
 => => exporting layers                                                                  0.0s
 => => writing image sha256:da33d53f866603eb678742518302b50669e10102b8644c0f02248ba498d  0.0s
 => => naming to docker.io/library/composetest-web                                       0.0s
 => [web] resolving provenance for metadata file                                         0.1s
[+] Running 3/3
 ✔ web                            Built                                                  0.0s
 ✔ Container composetest-redis-1  Running                                                0.0s
 ✔ Container composetest-web-1    Started                                                0.9s
Watch enabled
```

Dope!
